<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ratul LIV - Live Sports</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Prefetch -->
  <link rel="dns-prefetch" href="//firebasestorage.googleapis.com" />
  <link rel="dns-prefetch" href="//cdn.jwplayer.com" />
  <link rel="dns-prefetch" href="//ratul122.workers.dev" />

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

  <!-- Main CSS -->
  <link rel="stylesheet" href="style.css">

  <!-- Cloudflare Turnstile -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

  <!-- JW Player -->
  <script src="https://fle-rvd0i9o8-moo.com/player/jw8_26/jwplayer.js"></script>
  <script>jwplayer.key="eNFaXCjyURVoCCGiHp7HTQ3hDhE/AfL0g8VE1fRbL84=";</script>
</head>
<body>
  <!-- Turnstile overlay -->
  <div id="turnstileOverlay">
    <div id="turnstileBox">
      <h4>Verify you're human ðŸŽ­ DDOS & BOT security by Cloudflare</h4>
      <div class="cf-turnstile"
           data-sitekey="0x4AAAAAAB0sj0L7hIXQMc2l"
           data-callback="onTurnstileSuccess"></div>
    </div>
  </div>

  <!-- Main Content -->
  <div id="mainContent" class="container" style="display:none;">
    <header class="header">
      <div class="logo">Live Sports ðŸ‡§ðŸ‡©</div>
      <button class="menu-btn" id="menuBtn"><i class="fas fa-bars"></i></button>
      <div class="dropdown-menu" id="dropdownMenu">
        <a href="https://t.me/+5S-lx5CxGJEwMTdl" target="_blank">
          <i class="fab fa-telegram-plane"></i> Join Telegram
        </a>
        <a href="#about">About</a>
        <a href="#contact">Contact</a>
      </div>
    </header>

    <!-- Video Player -->
    <section class="featured-match" id="videoSection" style="display:none;">
      <div class="featured-title" id="videoTitle"></div>
      <div class="player-container">
        <div id="jwplayerDiv" class="video-player"></div>
      </div>
      <div class="server-options" id="serverRow"></div>
    </section>

    <!-- Main Tabs -->
    <nav class="nav-tabs">
      <button class="tab-btn active" id="tabFootball">Football</button>
      <button class="tab-btn" id="tabCricket">Cricket</button>
    </nav>

    <!-- Matches Sections -->
    <section id="football-section" class="matches-section"></section>
    <section id="cricket-section" class="matches-section hidden"></section>

    <footer class="footer">
      &copy; 2025 Ratul liv. All Rights Reserved.ðŸ‡§ðŸ‡©
    </footer>

    <div id="firebaseStatus" class="firebase-status">Initializing...</div>
  </div>

  <!-- Firebase Loader -->
  <script type="module">
    let firebaseInitialized = false;

    async function initializeFirebase() {
      if (firebaseInitialized) return; // prevent double init
      firebaseInitialized = true;

      try {
        const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
        const { getDatabase, ref, onValue } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');

        const firebaseConfig = {
          apiKey: "AIzaSyCkLQ5vf1z9dYjAVcOo7tm0BRT8N7jAbOw",
          authDomain: "ratul-liv.firebaseapp.com",
          databaseURL: "https://ratul-liv-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "ratul-liv",
          storageBucket: "ratul-liv.firebasestorage.app",
          messagingSenderId: "395032456768",
          appId: "1:395032456768:web:eadef753d410c71c5439a5",
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const matchesRef = ref(db, 'matches');

        onValue(matchesRef, (snapshot) => {
          const data = snapshot.val() || {};
          let football = data.football ? Object.values(data.football) : [];
          let cricket = data.cricket ? Object.values(data.cricket) : [];

          // --- Sorting logic ---
          function sortMatches(arr) {
            const order = { live: 0, upcoming: 1, ended: 2 };
            return arr.sort((a, b) => {
              if (order[a.status] !== order[b.status]) {
                return order[a.status] - order[b.status];
              }
              return new Date(b.startTime) - new Date(a.startTime); // newest first
            });
          }

          football = sortMatches(football);
          cricket = sortMatches(cricket);

          window.matches = { football, cricket };
          console.log("Firebase Data Ready", window.matches);
          document.dispatchEvent(new CustomEvent('firebaseDataReady'));
        });
      } catch (e) {
        console.error("Firebase error:", e);
      }
    }

    // Turnstile callback
    window.onTurnstileSuccess = function(token) {
      console.log("Turnstile verified:", token);
      document.getElementById("turnstileOverlay").style.display = "none";
      document.getElementById("mainContent").style.display = "block";
      initializeFirebase();
    }
  </script>

  <!-- App Logic -->
  <script src="app.js"></script>
</body>
</html>
